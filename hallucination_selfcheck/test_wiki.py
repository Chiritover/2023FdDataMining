from selfcheck import *
import json

def wiki_selfcheck(gpt_answer, annotation, samples):
    annotation_score = 0
    for label in annotation:
        if label == 'major_inaccurate':
            annotation_score += 0.2
        elif label == "minor_inaccurate":
            annotation_score += 0.1

    selfcheck_bertscore = SelfCheckBERTScore(default_model='en')
    sent_scores_bertscore = selfcheck_bertscore.predict(
        gpt_answer,
        samples,
    )

    sum = 0
    num = 0
    # print("annotation:")
    # print(annotation_score/len(annotation))
    # print("bert_score:")
    for s1 in sent_scores_bertscore:
        num += 1
        sum += s1
        # print("{:.4f}".format(s1))
    
    return np.abs(sum/num - annotation_score/len(annotation))

def check_ans(file):
    scores = []
    with open(file, 'r') as file:
        data = json.load(file)
        for i in range(238):
            gpt_answer = data[i]["gpt3_sentences"]
            annotation = data[i]['annotation']
            samples = data[i]['gpt3_text_samples']
            score = wiki_selfcheck(gpt_answer, annotation,samples)
            scores.append(score)
    return np.mean(scores)


if __name__ == "__main__":
    # gpt_answer = ["Matthew Aylmer, 1st Baron Aylmer (1708\u20131794) was an Irish soldier and colonial administrator.", "He was born in Dublin, the son of a barrister, and was educated at Trinity College, Dublin.", "He joined the British Army in 1727 and served in the War of the Austrian Succession and the Seven Years' War.",
    #               "He was promoted to lieutenant-general in 1772 and was appointed Governor of Gibraltar in 1775.", "He was made a baron in 1782 and was appointed Commander-in-Chief of the British forces in North America in 1783.", "He was recalled in 1790 and died in London in 1794.", "He was buried in Westminster Abbey."]
    # annotation = ["minor_inaccurate", "minor_inaccurate", "minor_inaccurate",
    #               "major_inaccurate", "major_inaccurate", "major_inaccurate", "major_inaccurate"]
    # samples = ["\"Matthew Aylmer, 1st Baron Aylmer (c. 1650\u20131720), was an Anglo-Irish soldier who served as Admiral of the Fleet in the Royal Navy. Born in Dublin, he was the son of Sir Matthew Aylmer and Lady Anne Barnham. Aylmer fought in the Battle of Solebay, the Battle of Bantry Bay, and the Battle of La Hogue. He was appointed commander-in-chief of the Irish Sea in 1702 and referred to as an 'extremely able admiral'. He commanded the fleet in the West Indies during the War of the Spanish Succession and played an important role in the Battle of Vigo Bay and the Battle of Malaga. He was made a baron in 1708 and was renowned for his loyalty to Queen Anne.\"", "Matthew Aylmer, 1st Baron Aylmer (1585\u20131641) was an English naval administrator, general, and politician who sat in the House of Commons from 1614 to 1626. He served as a Parliamentary commander during the First English Civil War, and attained the rank of General-at-Sea. Aylmer was the son of Sir Francis Aylmer and Dorothy Poyntz, daughter of Sir Anthony Poyntz of Iron Acton, Gloucestershire. He was baptised at Iron Acton on 25 November 1585.\n\nAylmer was a Member of Parliament in the Parliament of 1614\u20131625, representing Tewkesbury, Gloucestershire, from 1614 until 1626. He was appointed Master of the Ordnance in 1618, a post he held until 1626, when he was raised to the peerage as Baron Aylmer of Balrath, co. Meath. Aylmer was appointed Vice-Admiral of the West in 1633, and in 1635 he was appointed General-at", "Matthew Aylmer (1775 \u2013 22 June 1856), 1st Baron Aylmer, was a British naval officer, remembered primarily for his service as Commander-in-Chief, Plymouth.\n\nAylmer was born in 1775, the eldest son of Captain Thomas Aylmer of the Royal Navy and Mary (n\u00e9e Maghlin). He joined the Navy at an early age and was promoted to Lieutenant in 1796 and Commander in 1802. After serving in the West Indies and off Cadiz, Aylmer was appointed to the 32-gun frigate Cleopatra in 1806. He served as flag-captain to Vice-Admiral Sir Alexander Cochrane, who knighted him in 1809. In Cleopatra, Aylmer served in the Copenhagen campaign and the disastrous Walcheren Expedition.\n\nAylmer then served in the Baltic, taking command of the 74-gun Centaur, a post he held until 1812. He was promoted to Rear-Admiral in 1814 and advanced to a Knight Commander of the Order of the Bath", "Matthew Aylmer, 1st Baron Aylmer (1775\u20131850) was an English Royal Navy officer who served as the Commander-in-Chief, the Downs from 1828 to his death in 1850. He entered the Navy in 1788, and as a lieutenant served in the West Indies during the wars with France and Spain. He was promoted to commander in 1796, and took a post as a commander in the Channel Squadron. In 1802, he was appointed to command HM Sloop Curlew in the North Sea, where he was to distinguish himself in operations against the French Navy. He was promoted to post-captain in 1805 and saw action in the West Indies during the Napoleonic Wars. In 1817 he was promoted to rear-admiral, with his flag in the St George, and in 1821, he was made a baronet. He was appointed Commander-in-Chief of the Pacific Station in 1825, and Commander-in-Chief of the Downs in 1828. He received the title of Baron Aylmer in 1840. He", "Matthew Aylmer, 1st Baron Aylmer (c. 1650\u201322 April 1720) was a Royal Navy officer, who briefly served as Commander-in-Chief, Plymouth during the War of the Spanish Succession.\n\nAylmer was the son of Joshua Aylmer, a barrister, of Eastwell, Kent. He had four brothers: George, who married the sister of the Speaker of the House of Commons; Peyton, Governor of Fort St George; David, an officer in the Royal Navy; and John, Bishop of Norwich. His uncle was Sir Matthew Aylmer, 1st Baronet, of Broke, who was created a baronet in 1676.\n\nAylmer first served at sea under his brother David, later he joined the Navy at Chatham. He was promoted to Lieutenant in June 1673 and Commander in 1690. He then served in various commands at the Battle of Barfleur, for which he was promoted to Captain of the Ship on 7 December 1692.\n\nHe went on to serve under Sir John Trenchard", "Matthew Aylmer, 1st Baron Aylmer, KB (c. 1650 \u2013 25 August 1720) was an English Royal Navy commander and administrator. He is best known for his service as the commander-in-chief of the navy during the War of the Grand Alliance (1688\u201397).\n\nAylmer began his naval career at age 13, and served during the wars of the 1670s and 1680s. He became a captain in 1682 and was appointed to serve as the commander-in-chief of the Mediterranean squadron in 1689. During this time, he took part in the Battle of Beachy Head (1690) and the siege of Barcelona (1690\u201391).\n\nIn 1693, Aylmer was made a full admiral and appointed as the commander-in-chief of the English Channel squadron. In 1697, he was made a baron and appointed commander-in-chief of the Navy. He was instrumental in the defeat of the French fleet at the Battle of Vigo Bay (1702). After the Treaty of Ut", "Matthew Whitworth Aylmer, 1st Baron Aylmer, GCB (1775\u20131860) was a British naval commander and commander-in-chief of the Cape of Good Hope Station. He was the third son of Admiral Sir Hyde Parker and Lady Parker, daughter of the 4th Earl of Abercorn.\n\nHe entered the Navy in April 1789, serving in the Channel and the Mediterranean. On the 30 June 1791 he joined the Prince George, commanded by his elder brother Hyde, who died later that year. Aylmer was promoted to Lieutenant on 15 March 1795. He was appointed Fellow of the Royal Society in 1807.\n\nIn 1812 he was promoted to Rear-Admiral, and from 1815 to 1818 served as Commander-in Chief of the North American and West Indian Station. He was created Baron Aylmer of Balrath in the Peerage of the United Kingdom on 23 January 1818. He became Commander-in-Chief of the Cape of Good Hope and China Station from 1823\u20131825. He was promoted to", "Matthew Aylmer, 1st Baron Aylmer (6 October 1775 \u2013 4 October 1863), was a British naval commander, courtier and peer. He was born in Dublin, Ireland, the fifth and youngest son of General Sir Thomas Aylmer of Donadea, County Kildare and his wife Elizabeth, daughter of Paul Venables-Vernon, first Baron Vernon. He joined the Royal Navy at an early age and rose to become an Admiral of the Fleet. He took part in a number of battles during the Napoleonic Wars, ultimately commanding a squadron at the Battle of Trafalgar in 1805. After the war, he served as Commander in Chief, Plymouth and was appointed a Knight Grand Cross of the Order of the Bath. In 1846, he was created Baron Aylmer of Balrath, in the County of Meath. He died at his London residence in 1863.", "Matthew Aylmer, 1st Baron Aylmer (30 August 1775 \u2013 7 January 1856), was an officer of the British Royal Navy who served during the French Revolutionary and Napoleonic Wars and the War of 1812. He also served as Governor General of New South Wales between 1825 and 1830, where he was noted for his humanitarian attitude as well as his oppressive handling of the Colony's currency crisis. He was known for his straight shooting and for his ability to command respect from the lower decks of Navy ships.\n\nAylmer was born in 1775, the second son of Admiral Augustus Keppel, and the grandson of William Keppel, 2nd Earl of Albemarle. He joined the Royal Navy in 1785, and saw extensive service during the French Revolutionary and Napoleonic wars, first aboard the frigate Pelican and then on the Imp\u00e9tueux, fighting off the island of St. Lucia in 1794, and later taking part in the Battle of Trafalgar in 1805. By the time of the outbreak of the War of 1812 he was", "Matthew Whitworth-Aylmer, 1st Baron Aylmer, GCB (4 November 1775 \u2013 5 January 1856) was a British naval officer and colonial governor who served from 1811 to 1819 as Governor of Newfoundland after commanding several naval vessels over a 30-year career.\n\nAylmer was born in 1775, the son and heir of Edward Aylmer, a lawyer and judge in Dublin, Ireland. He joined the Royal Navy at a young age and saw action during the latter stages of the French Revolutionary Wars and the Napoleonic Wars. Promoted to lieutenant in 1795 and commander in 1798, he participated in several naval engagements, including the Egypt Expedition in 1801 and led a squadron in operations to suppress piracy in the Aegean Sea in 1811.\n\nAylmer was made a baronet in 1814 and later in 1823, he was created Baron Aylmer. In 1811, he was appointed Governor of Newfoundland, a position he held until 1819. During his governorship, he continued to serve in the Royal Navy and",
    #            "Matthew Aylmer, 1st Baron Aylmer, GCB (30 June 1775 \u2013 21 November 1819) was a British naval officer and colonial governor. He was born in London to Admiral Sir George Aylmer and his first wife, Elizabeth Holwell.\n\nHe entered the Royal Navy at age 13, serving as a volunteer in the Channel Fleet under his father. He was present at the Battle of the Glorious First of June in 1794, witnessing the destruction of three French vessels of the line, and was promoted lieutenant one month later. Aylmer gained his own command in the West Indies after a single year, and was promoted commander in 1798. Following a period of adversity, he was promoted post-captain in 1801 and went on to distinguish himself in many naval engagements of the Napoleonic Wars.\n\nAylmer was sent as governor to Tasmania in 1808, where he oversaw the founding of the convict settlement of Hobart. After two successful years, he returned to Britain and was given another post as governor of Barbados. He fought two battles against", "Matthew Aylmer, 1st Baron Aylmer, was an Anglo-Irish military commander who served in the English Civil War and Portuguese Restoration War, Admiral of the Fleet from 1676 to 1677, and Lord Lieutenant of Ireland from 1677 to 1683. Aylmer was born in Clonmel, County Tipperary, Ireland, in 1620 to a local landowner. He was educated in England, joining the Royal Navy in 1637. He served in the Thirty Years' War and the War of the Spanish Succession in the 1640s and '50s, becoming commander of the Royal Fleet in Ireland in 1649. He led the fleet to victory at the Battle of Dublin Bay in 1649, and was appointed commander-in-chief of the fleet in 1650. He fought in the Third Anglo-Dutch War in 1654, and was knighted for his part in the capture of the Dutch flagship. He was appointed Admiral of the Fleet in 1676, and Lord Lieutenant of Ireland in 1677. He held the title until 1683, when he died in London", "Matthew Aylmer, 1st Baron Aylmer, PC (1709\u20131781) was an Irish-born British naval officer and colonial governor. Born in Dublin, Aylmer entered the navy in 1735, and rose to the rank of vice-admiral in the course of a career that saw him serve numerous times in home waters. He was a skilled administrator and a respected commander, admired for his courage and tenacity. He proved a capable colonial governor in Canada, serving from 1755 to 1760. He sought to reform the government and improve relations with the Indigenous peoples of the region, but he alienated many settlers with his attempts to govern as an autocrat. He resigned in 1760, and in 1761 was created Baron Aylmer of Balrath.", "Matthew Aylmer, 1st Baron Aylmer (1708\u20131794) was an Anglo-Irish admiral and colonel of the Royal Irish Artillery. He was the son of General Matthew Aylmer and Elizabeth Colville, daughter of James Colville of Upper Grange, County Kilkenny. Aylmer joined the Royal Navy in 1720, and from 1738 to 1741, he served as Governor of Newfoundland. He was made Commodore-Governor of Jamaica from 1757 to 1760. He made significant contributions to the Royal Navy, including the introduction of regulations regarding the medical condition of sailors. He commanded the British fleet off Newfoundland in the Seven Years' War, and along with Commodore Augustus Keppel, helped to secure a victory over the French Fleet in the Battle of Quiberon Bay. Aylmer was made a Baron in 1775 and died in 1794.", "Matthew Aylmer, 1st Baron Aylmer (1708\u20131794) was an Irish/British naval commander who served as Commander-in-Chief, North American Station from 1776 to 1778, initially responsible for the Battle of Long Island and later for the reassertion of British control in the Caribbean.\n\nHe joined the Navy in 1720, rising to become Captain in 1737, and was Commander-in-Chief of the Mediterranean Fleet from 1770 to 1777. He was appointed Vice-Admiral of Great Britain in 1775 and Admiral of the Fleet in 1788. During his years in command of the North American station he was involved in a number of important sea battles during the American War of Independence. In 1777 he was instrumental in ensuring the safe evacuation of the British troops who were defeated at the Battle of Saratoga. \n\nAfter returning to Britain in 1778, he was appointed Deputy Lieutenant of Kent and served as Lieutenant, Deputy Constable and Governor of the Tower of London from 1779 to 1794. He was made an Irish peer in", "Matthew Aylmer, 1st Baron Aylmer (1775\u20131856) was a British naval officer. Born in Limerick, Ireland, he came from a family with a long maritime tradition. In 1788 Aylmer joined the Royal Navy and rose through the ranks steadily. During the French Revolutionary Wars and the Napoleonic Wars he saw active service, eventually rising to the rank of admiral. \n\nHe was an able commander, and his most notable successes included the capture of a Spanish frigate in 1800 and destroying a French squadron in the Caribbean in 1803. During the latter action he was promoted to the rank of rear admiral. He was made a baronet in 1808 for his service off the Basque Roads. Between 1808 and 1812 he served as commander-in-chief of the North Sea Station, leading a squadron that captured several Dutch ships in 1810. \n\nAylmer was promoted to Vice Admiral in 1814 and he was appointed Commander-in-Chief, East Indies and China Station in 1831. He held the post until 1836", "Matthew Aylmer, 1st Baron Aylmer (c.1650 \u2013 5 October 1720) was an Irish-born British admiral and colonial administrator who served as Governor of Newfoundland (1717\u20131720).\n\nAylmer was the second son of John Aylmer of Ballymacrane, County Kerry, and his wife, Catherine St. John de Berkley. In 1677, he joined the Royal Navy, and served under his uncle, Sir James Shaen, against the French and the Dutch. He was engaged in the battles of Orfordness in 1666, Texel in 1673, and Solebay in 1672.\n\nIn 1693, he was given command of the 60-gun warship HMS Adventure, and was promoted to rear-admiral in 1702. He was fleet commander of a large fleet sent to Portugal and Spain in 1704, and was promoted to vice-admiral in 1707. Aylmer was promoted to full admiral in 1707, and became Admiral of the Blue in 1708.", "Matthew Aylmer, 1st Baron Aylmer (c. 1660 \u2013 1720) was a British Admiral who served under King William III and Queen Anne. He was born in Dublin, Ireland and entered the Royal Navy at an early age, quickly rising through the ranks. Aylmer distinguished himself in the Battle of Beachy Head in 1690, commanding a squadron of ships against the French fleet. He also led an important battle against the Spanish off Cartagena in 1712. During the War of the Spanish Succession, he gained fame for his commanding the Royal Navy against the French forces, particularly at Vigo Bay in 1702. After the war, Aylmer was rewarded with an honorary knighthood by Queen Anne and was made Baron Aylmer in 1708. He served as Commander-in-Chief in the Mediterranean from 1712-1714 and later as Lord Commissioner of the Admiralty from 1714-1720. He died that year and was buried at St James's Church, Piccadilly.", "Matthew Aylmer, 1st Baron Aylmer (c. 1650 \u2013 19 April 1720) was an English naval commander and politician who served in two major conflicts of the eighteenth century, the Nine Years' War and the War of the Spanish Succession. He was also a member of the Privy Council from 1718 until his death in 1720. \n\nAylmer came from an old Devon family and was the eldest son of Admiral Matthew Aylmer and his wife Elizabeth, daughter of Edmund Prideaux of Nutwell in Devon. He served in the Navy from 1666, rising through the ranks until he was made Captain in 1685. This promotion was retrospective to December 1682, retroactive permission having been allowed by King Charles II of England.\n\nAylmer was present during the Nine Years' War and made several successful raids, particularly on Cadiz in 1696 and Cartagena in 1697. He also served at the Battle of Barfleur on 16 May 1692 and at the Battle of Velez-Malaga on 24 August 1704. He was", "Matthew Aylmer, 1st Baron Aylmer (1570\u20131631) was an English admiral and colonial administrator who served as the Lord High Admiral of England from 1614 to 1619. He was born in London, the son of Thomas Aymer and his wife Elizabeth, the daughter of Sir Thomas Pope of Abingdon. He went to sea at an early age, and entered the service of the English East India Company in 1604. He became a senior official in India, and gained the confidence and patronage of King James I. When the King became monarch of Great Britain in 1603, Aylmer was knighted and appointed as High Admiral and Governor of the English colonies in North America. He held this position from 1614 to 1619 and was responsible for the naval defence of the colony and the administration of justice. Aylmer was proclaimed Lord Aylmer of Balrath in County Meath, Ireland in 1620 and invested with the Order of the Bath in 1625. He died in London in 1631, aged 61."]

    # print("wiki_score:",wiki_selfcheck(gpt_answer, annotation, samples))

    wiki = check_ans("./dataset/wiki.json")
    with open("wiki.txt", "w", encoding='utf-8') as f:
      f.write("substitution数据集平均分: {}".format(wiki))
